(()=>{"use strict";const t=class{constructor(t){this.repository=t.repository,this.owner=t.owner,this.pull_number=t.pull_number,this.results=t.results}getDependencies(){return this.results.flatMap((t=>t.dependencies))}};var n=function(t,n,e,o){return new(e||(e=Promise))((function(r,s){function i(t){try{u(o.next(t))}catch(t){s(t)}}function c(t){try{u(o.throw(t))}catch(t){s(t)}}function u(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(i,c)}u((o=o.apply(t,n||[])).next())}))};const e=new class{getAnalysisOutput(n,e,o){return r=this,s=void 0,c=function*(){const r=yield fetch(`http://localhost:4000/analysis?owner=${n}&repo=${e}&pull_number=${o}`).then((t=>t.json())).then((n=>new t(n))).catch((t=>console.error(t)));if(!r)throw new Error("Analysis not found");return r},new((i=void 0)||(i=Promise))((function(t,n){function e(t){try{u(c.next(t))}catch(t){n(t)}}function o(t){try{u(c.throw(t))}catch(t){n(t)}}function u(n){var r;n.done?t(n.value):(r=n.value,r instanceof i?r:new i((function(t){t(r)}))).then(e,o)}u((c=c.apply(r,s||[])).next())}));var r,s,i,c}};chrome.tabs.onUpdated.addListener(((t,o,r)=>n(void 0,void 0,void 0,(function*(){if("complete"!==o.status)return;if(void 0===r.url)throw new Error("tab.url is undefined");const s=r.url.match(/^https:\/\/github\.com\/(.+)\/(.+)\/pull\/(\d+)\/files.*$/);if(null===s)return;console.log("Listener called at: "+r.url);const i=s[1],c=s[2],u=parseInt(s[3]);console.log("Owner: "+i),console.log("Repository: "+c),console.log("Pull number: "+u),yield function(t,o,r){return n(this,void 0,void 0,(function*(){return yield e.getAnalysisOutput(t,o,r)}))}(i,c,u).then((n=>{chrome.storage.local.set({analysis:n},(()=>{chrome.scripting.executeScript({target:{tabId:t},files:["./js/content.js"]})}))}))}))))})();